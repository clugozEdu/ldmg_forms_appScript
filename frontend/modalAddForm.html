<script>
  document.addEventListener("click", function (event) {
    if (event.target.matches("#add-forms")) {
      openModalNewForm();

      const departamentElement = document.getElementById(
        "id-departament-forms-new"
      );
      if (departamentElement) {
        departamentElement.innerHTML = "";
        createOptionsForSelects(
          arrayTitleDescription,
          "id-departament-forms-new"
        );
      }
    }

    // Si el botÃ³n 'save-form-new' fue clickeado
    if (event.target.matches("#save-form-new")) {
      showLoading();
      const idDepartament = document.getElementById("id-departament-forms-new");
      const selectedIndex = idDepartament.selectedIndex;
      const selectedOption = idDepartament.options[selectedIndex].text;

      const title = document.getElementById("title-forms-new");
      const titleForm = title.value;

      const description = document.getElementById("description-forms-new");
      const descriptionForm = description.value;

      let formDepartmentId;

      objectDepartamentList.forEach((form) => {
        if (selectedOption === form.departament) {
          formDepartmentId = form.idMysql;
        }
      });

      let newForm = {
        formDepartmentId: formDepartmentId,
        description: descriptionForm,
        title: titleForm,
      };

      google.script.run
        .withSuccessHandler((data) => {
          if (data?.length > 0) {
            swalWithBootstrapButtons.fire({
              title: "Excellent!",
              html: `<P>The form has been successfully saved</P>`,
              icon: "success",
              confirmButtonText: "Ok",
            });

            resetForm(idDepartament, title, description);

            setTimeout(() => {
              loadForms();
            }, 3000);

            const modal = document.getElementById("new-form-modal");
            if (modal) {
              const modalIntance = bootstrap.Modal.getInstance(modal);
              modalIntance.hide();
            }
          } else {
            hiddenLoading();
            swalWithBootstrapButtons.fire({
              title: "Error!",
              html: `<P>There was an error saving the form</P>`,
              icon: "error",
              confirmButtonText: "Ok",
            });
          }
        })
        .addNewForm(newForm);
    }
  });
</script>
