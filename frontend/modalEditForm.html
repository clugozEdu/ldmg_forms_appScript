<script>
  let idMysqlForm;

  function handleEditButtonClickFormEdit(event) {
    openModalEditForm();
    createOptionsForSelects(arrayTitleDescription, "edit-departament-forms");

    const button = event.currentTarget;
    const row = button.closest("tr");

    const dataRow = row.querySelectorAll("td");
    const dataDepartament = dataRow[0].textContent;
    const dataFormId = dataRow[1].textContent;
    const dataColumnDescription = dataRow[2].textContent;
    const formId = dataRow[3].dataset.id;

    idMysqlForm = formId;

    let selectedDepartament = [];

    objectForms.forEach((forms) => {
      if (formId === forms.mySQLId) {
        document.getElementById("edit-title-forms").value = dataFormId;
        document.getElementById("edit-description-forms").value =
          forms.formDescription;
        selectedDepartament.push(forms.formDepartmentTitle);
      }
    });

    arrayTitleDescription.forEach((departament, index) => {
      if (selectedDepartament[0] === departament) {
        document.getElementById("edit-departament-forms").value =
          document.getElementById("edit-departament-forms").selectedIndex =
            index;
      }
    });

    const buttonAddFormModal = document.getElementById("save-form-edit");
    buttonAddFormModal.removeEventListener("click", saveEditForm);
    buttonAddFormModal.addEventListener("click", saveEditForm);
  }

  function initEventButtonEdit() {
    const editButtons = document.querySelectorAll(".btn-edit");
    editButtons.forEach((button) => {
      button.removeEventListener("click", handleEditButtonClickFormEdit);
      button.addEventListener("click", handleEditButtonClickFormEdit);
    });
  }

  // La funciÃ³n saveEditForm sigue siendo la misma
  function saveEditForm() {
    showLoading();
    const idDepartament = document.getElementById("edit-departament-forms");
    const selectedIndex = idDepartament.selectedIndex;
    const selectedOption = idDepartament.options[selectedIndex].text;

    const title = document.getElementById("edit-title-forms");
    const titleForm = title.value;

    const description = document.getElementById("edit-description-forms");
    const descriptionForm = description.value;

    let departamentIdMysql;

    objectDepartamentList.forEach((departament) => {
      if (departament.departament === selectedOption) {
        departamentIdMysql = departament.idMysql;
      }
    });

    const editForm = {
      formId: idMysqlForm,
      formDepartmentId: departamentIdMysql,
      description: descriptionForm,
      title: titleForm,
    };

    google.script.run
      .withSuccessHandler((data) => {
        if (data?.length > 0) {
          swalWithBootstrapButtons.fire({
            title: "Excellent!",
            html: `<P>Changes have been saved</P>`,
            icon: "success",
            confirmButtonText: "Ok",
          });
          setTimeout(() => {
            loadForms();
          }, 3000);

          const modal = document.getElementById("edit-form-modal");
          const modalIntance = bootstrap.Modal.getInstance(modal);
          modalIntance.hide();
        } else {
          hiddenLoading();
          swalWithBootstrapButtons.fire({
            title: "Error!",
            html: `<P>There was an error saving the form</P>`,
            icon: "error",
            confirmButtonText: "Ok",
          });
        }
      })
      .updateForm(editForm);
  }
</script>
